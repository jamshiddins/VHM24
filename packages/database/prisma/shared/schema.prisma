generator client {
  provider = "prisma-client-js"
  output   = "../../node_modules/@prisma/client/shared"
}

datasource db {
  provider = "postgresql"
  url      = env("SHARED_DATABASE_URL")
}

// ENUMS
enum TransactionStatus {
  SUCCESS
  FAILED
  PENDING
  REFUNDED
}

enum PaymentType {
  CASH
  CARD
  QR
  MOBILE
}

// MODELS
model Transaction {
  id          String            @id @default(cuid())
  machineId   String            // Machine ID from machines service
  amount      Float
  currency    String            @default("RUB")
  paymentType PaymentType
  status      TransactionStatus
  reference   String?           @unique
  metadata    Json?
  createdAt   DateTime          @default(now())
  
  @@index([machineId])
  @@index([createdAt])
  @@index([status])
  @@index([reference])
}

// Analytics aggregated data
model DailySales {
  id          String   @id @default(cuid())
  date        DateTime @db.Date
  machineId   String   // Machine ID from machines service
  totalSales  Float
  totalCount  Int
  currency    String   @default("RUB")
  createdAt   DateTime @default(now())
  
  @@unique([date, machineId])
  @@index([date])
  @@index([machineId])
}

// System-wide notifications
model Notification {
  id          String   @id @default(cuid())
  type        String   // ALERT, INFO, WARNING, ERROR
  title       String
  message     String
  metadata    Json?
  userId      String?  // User ID from auth service (null for broadcast)
  isRead      Boolean  @default(false)
  readAt      DateTime?
  createdAt   DateTime @default(now())
  
  @@index([userId, isRead])
  @@index([type])
  @@index([createdAt])
}

// System configuration
model SystemConfig {
  id        String   @id @default(cuid())
  key       String   @unique
  value     Json
  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())
  
  @@index([key])
}
