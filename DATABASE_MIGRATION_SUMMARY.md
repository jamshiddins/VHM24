# üìä –ò—Ç–æ–≥–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö VHM24

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–∞

- ‚ùå **–£–¥–∞–ª–µ–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç Supabase**
- ‚úÖ **–°–æ–∑–¥–∞–Ω–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º**
- ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Redis –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è**

### 2. –°–æ–∑–¥–∞–Ω—ã –æ—Ç–¥–µ–ª—å–Ω—ã–µ Prisma —Å—Ö–µ–º—ã

```
packages/database/prisma/
‚îú‚îÄ‚îÄ auth/schema.prisma       # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, —Å–µ—Å—Å–∏–∏, –∞—É–¥–∏—Ç
‚îú‚îÄ‚îÄ machines/schema.prisma   # –ú–∞—à–∏–Ω—ã, –ª–æ–∫–∞—Ü–∏–∏, —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è
‚îú‚îÄ‚îÄ inventory/schema.prisma  # –¢–æ–≤–∞—Ä—ã, —Å–∫–ª–∞–¥, –¥–≤–∏–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ tasks/schema.prisma      # –ó–∞–¥–∞—á–∏, –¥–µ–π—Å—Ç–≤–∏—è, —à–∞–±–ª–æ–Ω—ã
‚îî‚îÄ‚îÄ shared/schema.prisma     # –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
```

### 3. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫–ª–∏–µ–Ω—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

- `getAuthClient()` - –¥–ª—è auth —Å–µ—Ä–≤–∏—Å–∞
- `getMachinesClient()` - –¥–ª—è machines —Å–µ—Ä–≤–∏—Å–∞
- `getInventoryClient()` - –¥–ª—è inventory —Å–µ—Ä–≤–∏—Å–∞
- `getTasksClient()` - –¥–ª—è tasks —Å–µ—Ä–≤–∏—Å–∞
- `getSharedClient()` - –¥–ª—è –æ–±—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö

### 4. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–≤—É—Ö —Ä–µ–∂–∏–º–æ–≤ —Ä–∞–±–æ—Ç—ã

- **Single Database Mode** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) - –æ–¥–Ω–∞ –ë–î —Å —Ä–∞–∑–Ω—ã–º–∏ —Å—Ö–µ–º–∞–º–∏
- **Multiple Database Mode** - –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ë–î –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

### 5. –°–æ–∑–¥–∞–Ω—ã —Ñ–∞–π–ª—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `.env.production` - —à–∞–±–ª–æ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `migrate-from-supabase.js` - —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- `SUPABASE_MIGRATION_GUIDE.md` - –ø–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
- `DATABASE_MIGRATION_PLAN.md` - –ø–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏
- –û–±–Ω–æ–≤–ª–µ–Ω `packages/database/package.json` —Å –Ω–æ–≤—ã–º–∏ —Å–∫—Ä–∏–ø—Ç–∞–º–∏

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (Railway)

1. **–°–æ–∑–¥–∞–π—Ç–µ PostgreSQL –≤ Railway:**

```bash
# –í Railway Dashboard
Add Service ‚Üí Database ‚Üí PostgreSQL
```

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**

```bash
railway variables --set "DATABASE_URL=postgresql://..."
railway variables --set "USE_MULTIPLE_DATABASES=false"
```

3. **–û–±–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã:**

```javascript
// –ë—ã–ª–æ:
const { PrismaClient } = require('@prisma/client');
const prisma = new PrismaClient();

// –°—Ç–∞–ª–æ:
const { getAuthClient } = require('@vhm24/database');
const prisma = getAuthClient();
```

4. **–î–µ–ø–ª–æ–π:**

```bash
git add .
git commit -m "Migrate to scalable database architecture"
git push
```

## üìã –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ:

```env
DATABASE_URL=postgresql://user:pass@host:5432/dbname
REDIS_URL=redis://default:pass@redis.railway.internal:6379
JWT_SECRET=your-secret
TELEGRAM_BOT_TOKEN=your-token
```

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ (–¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ë–î):

```env
USE_MULTIPLE_DATABASES=true
AUTH_DATABASE_URL=postgresql://...
MACHINES_DATABASE_URL=postgresql://...
INVENTORY_DATABASE_URL=postgresql://...
TASKS_DATABASE_URL=postgresql://...
SHARED_DATABASE_URL=postgresql://...
```

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

1. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –∫–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –º–æ–∂–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - Redis –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. **–ò–∑–æ–ª—è—Ü–∏—è** - –ø—Ä–æ–±–ª–µ–º—ã –≤ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–∏—Å–µ –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –¥—Ä—É–≥–∏–µ
4. **–ì–∏–±–∫–æ—Å—Ç—å** - –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –ë–î –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
5. **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏–π** - –∫–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –º–∏–≥—Ä–∏—Ä—É–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ

## üîß –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Prisma –∫–ª–∏–µ–Ω—Ç–æ–≤
cd packages/database
npm run generate:all

# –ú–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
npm run migrate:dev:all

# –ú–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
npm run migrate:deploy:all

# Prisma Studio –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
npm run studio:auth
npm run studio:machines
npm run studio:inventory
npm run studio:tasks
npm run studio:shared
```

## ‚ö†Ô∏è –í–∞–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å

1. **–ü–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π —Å–¥–µ–ª–∞–π—Ç–µ –±–µ–∫–∞–ø –¥–∞–Ω–Ω—ã—Ö**
2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ staging –æ–∫—Ä—É–∂–µ–Ω–∏–∏**
3. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏**
4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Redis –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—è–∂–µ–ª—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤**

## üìà –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –∏–∑ Supabase
2. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
3. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã
4. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Redis

---

**–°—Ç–∞—Ç—É—Å**: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –¢—Ä–µ–±—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–∏—Ç—å DATABASE_URL –≤ Railway –∏
–∑–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é.
