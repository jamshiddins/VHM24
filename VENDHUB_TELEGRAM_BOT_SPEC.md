# VendHub Telegram Bot Specification

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–æ—Ç–∞

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
- **Framework**: Telegraf.js v4
- **State Management**: FSM (Finite State Machine)
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL —á–µ—Ä–µ–∑ Prisma ORM
- **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: Redis –¥–ª—è —Å–µ—Å—Å–∏–π
- **–ú–µ–¥–∏–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ**: S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ (MinIO/AWS S3)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ FSM —Å–æ—Å—Ç–æ—è–Ω–∏–π

```
START
‚îú‚îÄ‚îÄ AUTH
‚îÇ   ‚îú‚îÄ‚îÄ PHONE_REQUEST
‚îÇ   ‚îî‚îÄ‚îÄ PHONE_CONFIRM
‚îú‚îÄ‚îÄ MAIN_MENU
‚îÇ   ‚îú‚îÄ‚îÄ WAREHOUSE_MENU
‚îÇ   ‚îú‚îÄ‚îÄ OPERATOR_MENU
‚îÇ   ‚îú‚îÄ‚îÄ MANAGER_MENU
‚îÇ   ‚îî‚îÄ‚îÄ ADMIN_MENU
‚îî‚îÄ‚îÄ OPERATIONS
    ‚îú‚îÄ‚îÄ BUNKER_*
    ‚îú‚îÄ‚îÄ SYRUP_*
    ‚îú‚îÄ‚îÄ WATER_*
    ‚îú‚îÄ‚îÄ MACHINE_*
    ‚îú‚îÄ‚îÄ FINANCE_*
    ‚îî‚îÄ‚îÄ REPORTS_*
```

## –†–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

### WAREHOUSE (–°–∫–ª–∞–¥)
- –ü—Ä–∏–µ–º —Ç–æ–≤–∞—Ä–æ–≤ –∏ –ø–∞—Ä—Ç–∏–π
- –í—ã–¥–∞—á–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º
- –ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è —Å–∫–ª–∞–¥–∞
- –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Å—Ç–∞—Ç–∫–æ–≤

### OPERATOR (–û–ø–µ—Ä–∞—Ç–æ—Ä)
- –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–æ–≤
- –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –±—É–Ω–∫–µ—Ä–∞–º–∏/—Å–∏—Ä–æ–ø–∞–º–∏/–≤–æ–¥–æ–π
- –°–±–æ—Ä –≤—ã—Ä—É—á–∫–∏
- –§–æ—Ç–æ–æ—Ç—á–µ—Ç—ã

### MANAGER (–ú–µ–Ω–µ–¥–∂–µ—Ä)
- –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ OPERATOR
- –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á–µ—Ç–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞

### ADMIN (–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)
- –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- –°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –û–±—â–∏–µ –∫–æ–º–∞–Ω–¥—ã
- `/start` - –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã
- `/menu` - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
- `/help` - –ü–æ–º–æ—â—å
- `/profile` - –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `/cancel` - –û—Ç–º–µ–Ω–∞ —Ç–µ–∫—É—â–µ–π –æ–ø–µ—Ä–∞—Ü–∏–∏

### –ö–æ–º–∞–Ω–¥—ã –ø–æ —Ä–æ–ª—è–º
- `/machines` - –°–ø–∏—Å–æ–∫ –∞–≤—Ç–æ–º–∞—Ç–æ–≤ (OPERATOR+)
- `/stock` - –û—Å—Ç–∞—Ç–∫–∏ –Ω–∞ —Å–∫–ª–∞–¥–µ (WAREHOUSE+)
- `/reports` - –û—Ç—á–µ—Ç—ã (MANAGER+)
- `/users` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (ADMIN)

## –î–µ—Ç–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### 1. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

```mermaid
graph TD
    A[/start] --> B{–ï—Å—Ç—å –≤ –±–∞–∑–µ?}
    B -->|–ù–µ—Ç| C[–ó–∞–ø—Ä–æ—Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞]
    B -->|–î–∞| D[–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é]
    C --> E[–û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–∞]
    E --> F[–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞]
    F --> G{–ö–æ–¥ –≤–µ—Ä–Ω—ã–π?}
    G -->|–î–∞| D
    G -->|–ù–µ—Ç| E
```

#### –°–æ—Å—Ç–æ—è–Ω–∏—è:
- `AUTH.PHONE_REQUEST` - –ó–∞–ø—Ä–æ—Å –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- `AUTH.PHONE_CONFIRM` - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∫–æ–¥–∞

#### –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã:
```javascript
// –ó–∞–ø—Ä–æ—Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞
{
  keyboard: [[{
    text: "üì± –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞",
    request_contact: true
  }]],
  resize_keyboard: true
}

// –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∫–æ–¥–∞
{
  keyboard: [
    ["1", "2", "3"],
    ["4", "5", "6"],
    ["7", "8", "9"],
    ["‚¨ÖÔ∏è –£–¥–∞–ª–∏—Ç—å", "0", "‚úÖ OK"]
  ],
  resize_keyboard: true
}
```

### 2. –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –±—É–Ω–∫–µ—Ä–∞–º–∏

#### 2.1 –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –±—É–Ω–∫–µ—Ä–∞

**–°–æ—Å—Ç–æ—è–Ω–∏—è:**
- `BUNKER.SELECT` - –í—ã–±–æ—Ä –±—É–Ω–∫–µ—Ä–∞
- `BUNKER.SCAN_QR` - –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ QR –∫–æ–¥–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `BUNKER.WEIGH_EMPTY` - –í–∑–≤–µ—à–∏–≤–∞–Ω–∏–µ –ø—É—Å—Ç–æ–≥–æ
- `BUNKER.FILL_INGREDIENT` - –í—ã–±–æ—Ä –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞ –∏ –ø–∞—Ä—Ç–∏–∏
- `BUNKER.WEIGH_FULL` - –í–∑–≤–µ—à–∏–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ
- `BUNKER.PHOTO` - –§–æ—Ç–æ—Ñ–∏–∫—Å–∞—Ü–∏—è
- `BUNKER.CONFIRM` - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ

**–ü—Ä–∏–º–µ—Ä –¥–∏–∞–ª–æ–≥–∞:**
```
–ë–û–¢: üóÉ –í—ã–±–µ—Ä–∏—Ç–µ –±—É–Ω–∫–µ—Ä –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ QR-–∫–æ–¥–∞
    [Inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å–æ —Å–ø–∏—Å–∫–æ–º –±—É–Ω–∫–µ—Ä–æ–≤]

USER: [–í—ã–±–∏—Ä–∞–µ—Ç SET-005-1CO]

–ë–û–¢: –ë—É–Ω–∫–µ—Ä SET-005-1CO (–ö–æ—Ñ–µ)
    üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å: –ù–∞ —Å–∫–ª–∞–¥–µ
    ‚öñÔ∏è –í–≤–µ–¥–∏—Ç–µ –≤–µ—Å –ø—É—Å—Ç–æ–≥–æ –±—É–Ω–∫–µ—Ä–∞ (–≥):

USER: 450

–ë–û–¢: ‚úÖ –í–µ—Å –ø—É—Å—Ç–æ–≥–æ: 450–≥
    üåü –í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä—Ç–∏—é –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è:
    
    1Ô∏è‚É£ PARTY-2024-COFF-08
    üì¶ –û—Å—Ç–∞—Ç–æ–∫: 45.5 –∫–≥
    üìÖ –ì–æ–¥–µ–Ω –¥–æ: 01.12.2024
    
    2Ô∏è‚É£ PARTY-2024-COFF-10
    üì¶ –û—Å—Ç–∞—Ç–æ–∫: 80 –∫–≥
    üìÖ –ì–æ–¥–µ–Ω –¥–æ: 15.01.2025

USER: [–í—ã–±–∏—Ä–∞–µ—Ç –ø–∞—Ä—Ç–∏—é 2]

–ë–û–¢: ‚úÖ –í—ã–±—Ä–∞–Ω–∞ –ø–∞—Ä—Ç–∏—è PARTY-2024-COFF-10
    üîÑ –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –±—É–Ω–∫–µ—Ä –∏ –≤–∑–≤–µ—Å—å—Ç–µ
    ‚öñÔ∏è –í–≤–µ–¥–∏—Ç–µ –≤–µ—Å –ø–æ–ª–Ω–æ–≥–æ –±—É–Ω–∫–µ—Ä–∞ (–≥):

USER: 1450

–ë–û–¢: üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è:
    ‚Ä¢ –ü—É—Å—Ç–æ–π: 450–≥
    ‚Ä¢ –ü–æ–ª–Ω—ã–π: 1450–≥
    ‚Ä¢ –ù–µ—Ç—Ç–æ: 1000–≥
    
    üì∏ –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ –±—É–Ω–∫–µ—Ä–∞

USER: [–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ç–æ]

–ë–û–¢: ‚úÖ –û–ø–µ—Ä–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!
    
    üóÉ –ë—É–Ω–∫–µ—Ä: SET-005-1CO
    ‚òï –ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç: –ö–æ—Ñ–µ (1000–≥)
    üì¶ –ü–∞—Ä—Ç–∏—è: PARTY-2024-COFF-10
    üïê –í—Ä–µ–º—è: 15.01.2024 09:00
    
    [–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é]
```

#### 2.2 –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ –∞–≤—Ç–æ–º–∞—Ç

**–°–æ—Å—Ç–æ—è–Ω–∏—è:**
- `BUNKER.SELECT_FOR_INSTALL` - –í—ã–±–æ—Ä –±—É–Ω–∫–µ—Ä–∞
- `BUNKER.SELECT_MACHINE` - –í—ã–±–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∞
- `BUNKER.SELECT_POSITION` - –í—ã–±–æ—Ä –ø–æ–∑–∏—Ü–∏–∏
- `BUNKER.CONFIRM_INSTALL` - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ

**–ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã:**
```javascript
// –í—ã–±–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∞ - inline keyboard
{
  inline_keyboard: [
    [{text: "VM-001-TASH-CENT üìç", callback_data: "machine:VM-001"}],
    [{text: "VM-015-TASH-WEST üìç", callback_data: "machine:VM-015"}],
    [{text: "üîç –ü–æ–∏—Å–∫ –ø–æ –∫–æ–¥—É", callback_data: "search_machine"}]
  ]
}

// –í—ã–±–æ—Ä –ø–æ–∑–∏—Ü–∏–∏ - –≤–∏–∑—É–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞
{
  inline_keyboard: [
    [
      {text: "1Ô∏è‚É£ –ö–æ—Ñ–µ", callback_data: "pos:1"},
      {text: "2Ô∏è‚É£ –°–ª–∏–≤–∫–∏", callback_data: "pos:2"}
    ],
    [
      {text: "3Ô∏è‚É£ –®–æ–∫–æ–ª–∞–¥", callback_data: "pos:3"},
      {text: "4Ô∏è‚É£ –°–∞—Ö–∞—Ä", callback_data: "pos:4"}
    ],
    [
      {text: "5Ô∏è‚É£ –ú–æ–ª–æ–∫–æ", callback_data: "pos:5"},
      {text: "6Ô∏è‚É£ –ö–∞–ø—É—á–∏–Ω–æ", callback_data: "pos:6"}
    ],
    [
      {text: "7Ô∏è‚É£ –î–µ–∫–∞—Ñ", callback_data: "pos:7"},
      {text: "8Ô∏è‚É£ –ß–∞–π", callback_data: "pos:8"}
    ]
  ]
}
```

#### 2.3 –°–Ω—è—Ç–∏–µ –∏–∑ –∞–≤—Ç–æ–º–∞—Ç–∞

**–°–æ—Å—Ç–æ—è–Ω–∏—è:**
- `BUNKER.SELECT_MACHINE_REMOVE` - –í—ã–±–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∞
- `BUNKER.SELECT_BUNKER_REMOVE` - –í—ã–±–æ—Ä –±—É–Ω–∫–µ—Ä–∞ –¥–ª—è —Å–Ω—è—Ç–∏—è
- `BUNKER.WEIGH_RETURN` - –í–∑–≤–µ—à–∏–≤–∞–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—Ç–∞
- `BUNKER.WASTE_WEIGHT` - –í–µ—Å –æ—Ç—Ö–æ–¥–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `BUNKER.PHOTO_REMOVE` - –§–æ—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- `BUNKER.CONFIRM_REMOVE` - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ

### 3. –û–ø–µ—Ä–∞—Ü–∏–∏ —Å —Å–∏—Ä–æ–ø–∞–º–∏

#### 3.1 –ü—Ä–∏–µ–º –Ω–æ–≤–æ–≥–æ —Å–∏—Ä–æ–ø–∞

**–°–æ—Å—Ç–æ—è–Ω–∏—è:**
- `SYRUP.NEW_TYPE` - –í—ã–±–æ—Ä —Ç–∏–ø–∞
- `SYRUP.NEW_VOLUME` - –í–≤–æ–¥ –æ–±—ä–µ–º–∞
- `SYRUP.NEW_BATCH` - –í—ã–±–æ—Ä –ø–∞—Ä—Ç–∏–∏
- `SYRUP.NEW_EXPIRY` - –°—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏
- `SYRUP.NEW_PHOTO` - –§–æ—Ç–æ
- `SYRUP.NEW_CONFIRM` - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ

**–ü—Ä–∏–º–µ—Ä inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è —Ç–∏–ø–æ–≤:**
```javascript
{
  inline_keyboard: [
    [
      {text: "üçØ –ö–∞—Ä–∞–º–µ–ª—å", callback_data: "syrup:CARAMEL"},
      {text: "üç¶ –í–∞–Ω–∏–ª—å", callback_data: "syrup:VANILLA"}
    ],
    [
      {text: "ü•• –ö–æ–∫–æ—Å", callback_data: "syrup:COCONUT"},
      {text: "üå∞ –õ–µ—Å–Ω–æ–π –æ—Ä–µ—Ö", callback_data: "syrup:HAZELNUT"}
    ],
    [
      {text: "ü•É –ê–º–∞—Ä–µ—Ç—Ç–æ", callback_data: "syrup:AMARETTO"},
      {text: "‚òòÔ∏è –ò—Ä–ª–∞–Ω–¥—Å–∫–∏–π –∫—Ä–µ–º", callback_data: "syrup:IRISH_CREAM"}
    ],
    [
      {text: "üç´ –®–æ–∫–æ–ª–∞–¥", callback_data: "syrup:CHOCOLATE"}
    ],
    [
      {text: "‚ûï –î—Ä—É–≥–æ–π —Ç–∏–ø", callback_data: "syrup:CUSTOM"}
    ]
  ]
}
```

### 4. –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∞

#### 4.1 –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

**–°–æ—Å—Ç–æ—è–Ω–∏—è:**
- `MACHINE.SELECT_SERVICE` - –í—ã–±–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∞
- `MACHINE.SERVICE_TYPE` - –¢–∏–ø –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
- `MACHINE.SERVICE_CHECKLIST` - –ß–µ–∫-–ª–∏—Å—Ç –æ–ø–µ—Ä–∞—Ü–∏–π
- `MACHINE.SERVICE_COMPONENTS` - –ó–∞–º–µ–Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- `MACHINE.SERVICE_REVENUE` - –°–±–æ—Ä –≤—ã—Ä—É—á–∫–∏
- `MACHINE.SERVICE_PHOTOS` - –§–æ—Ç–æ–æ—Ç—á–µ—Ç
- `MACHINE.SERVICE_COMPLETE` - –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ

**–ß–µ–∫-–ª–∏—Å—Ç –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è:**
```
‚òê –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
‚òê –ß–∏—Å—Ç–∫–∞ –ø–æ–¥–¥–æ–Ω–∞
‚òê –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ä–æ–≤–Ω–µ–π –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
‚òê –ß–∏—Å—Ç–∫–∞ –º–∏–∫—Å–µ—Ä–æ–≤
‚òê –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã –ø–æ–¥–∞—á–∏ –≤–æ–¥—ã
‚òê –¢–µ—Å—Ç –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è –Ω–∞–ø–∏—Ç–∫–æ–≤
‚òê –°–±–æ—Ä –≤—ã—Ä—É—á–∫–∏
‚òê –§–æ—Ç–æ–æ—Ç—á–µ—Ç
```

### 5. –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

#### 5.1 –°–±–æ—Ä –≤—ã—Ä—É—á–∫–∏

**–°–æ—Å—Ç–æ—è–Ω–∏—è:**
- `FINANCE.REVENUE_MACHINE` - –í—ã–±–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∞
- `FINANCE.REVENUE_CASH` - –í–≤–æ–¥ –Ω–∞–ª–∏—á–Ω—ã—Ö
- `FINANCE.REVENUE_QR` - QR –ø–ª–∞—Ç–µ–∂–∏ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- `FINANCE.REVENUE_PHOTO` - –§–æ—Ç–æ —á–µ–∫–æ–≤/–æ—Ç—á–µ—Ç–∞
- `FINANCE.REVENUE_CONFIRM` - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ

**–ü—Ä–∏–º–µ—Ä –≤–≤–æ–¥–∞:**
```
–ë–û–¢: üí∞ –°–±–æ—Ä –≤—ã—Ä—É—á–∫–∏ VM-015-TASH-WEST
    
    üìä –ü–æ—Å–ª–µ–¥–Ω–∏–π —Å–±–æ—Ä: 10.01.2024
    üí≥ QR –ø–ª–∞—Ç–µ–∂–∏: 125,000 —Å—É–º (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
    
    üíµ –í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –Ω–∞–ª–∏—á–Ω—ã—Ö:

USER: 45000

–ë–û–¢: ‚úÖ –ù–∞–ª–∏—á–Ω—ã–µ: 45,000 —Å—É–º
    üí≥ QR: 125,000 —Å—É–º
    üí∞ –ò—Ç–æ–≥–æ: 170,000 —Å—É–º
    
    üì∏ –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ Z-–æ—Ç—á–µ—Ç–∞ –∏–ª–∏ —á–µ–∫–æ–≤

USER: [–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ç–æ]

–ë–û–¢: ‚úÖ –í—ã—Ä—É—á–∫–∞ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞!
    
    üè™ –ê–≤—Ç–æ–º–∞—Ç: VM-015-TASH-WEST
    üí∞ –°—É–º–º–∞: 170,000 —Å—É–º
    üìÖ –ü–µ—Ä–∏–æ–¥: 10.01 - 15.01.2024
    
    [–†–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å –æ—Ç—á–µ—Ç] [–í –º–µ–Ω—é]
```

#### 5.2 –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞—Å—Ö–æ–¥–∞

**–°–æ—Å—Ç–æ—è–Ω–∏—è:**
- `FINANCE.EXPENSE_CATEGORY` - –ö–∞—Ç–µ–≥–æ—Ä–∏—è —Ä–∞—Å—Ö–æ–¥–∞
- `FINANCE.EXPENSE_AMOUNT` - –°—É–º–º–∞
- `FINANCE.EXPENSE_DETAILS` - –î–µ—Ç–∞–ª–∏
- `FINANCE.EXPENSE_DOCUMENT` - –î–æ–∫—É–º–µ–Ω—Ç—ã
- `FINANCE.EXPENSE_CONFIRM` - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ

### 6. –û—Ç—á–µ—Ç—ã

#### 6.1 –û–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–µ –æ—Ç—á–µ—Ç—ã

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –æ—Ç—á–µ—Ç—ã:**
```
üìä –û–ü–ï–†–ê–¢–ò–í–ù–´–ï –û–¢–ß–ï–¢–´

1Ô∏è‚É£ –°–æ—Å—Ç–æ—è–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–æ–≤
2Ô∏è‚É£ –ù–∏–∑–∫–∏–µ –æ—Å—Ç–∞—Ç–∫–∏ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
3Ô∏è‚É£ –¢—Ä–µ–±—É–µ–º—ã–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è
4Ô∏è‚É£ –ì—Ä–∞—Ñ–∏–∫ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
5Ô∏è‚É£ –ê–∫—Ç–∏–≤–Ω—ã–µ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–∏

üìà –ê–ù–ê–õ–ò–¢–ò–ö–ê

6Ô∏è‚É£ –î–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –ø–æ –∞–≤—Ç–æ–º–∞—Ç–∞–º
7Ô∏è‚É£ –ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å –Ω–∞–ø–∏—Ç–∫–æ–≤
8Ô∏è‚É£ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç—á–µ—Ç–∞:**
```
üìä –°–û–°–¢–û–Ø–ù–ò–ï –ê–í–¢–û–ú–ê–¢–û–í
–î–∞—Ç–∞: 15.01.2024 11:00

‚úÖ –ê–∫—Ç–∏–≤–Ω—ã–µ: 38 –∏–∑ 45
‚ö†Ô∏è –¢—Ä–µ–±—É—é—Ç –≤–Ω–∏–º–∞–Ω–∏—è: 5
üîß –ù–∞ —Ä–µ–º–æ–Ω—Ç–µ: 2

–¢–†–ï–ë–£–Æ–¢ –í–ù–ò–ú–ê–ù–ò–Ø:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üî¥ VM-005-TASH-NORTH
‚îú üìç –¢–¶ –ú–µ–≥–∞ –ü–ª–∞–Ω–µ—Ç
‚îú ‚ö†Ô∏è –ö–æ—Ñ–µ < 10%
‚îî üë§ –û–ø–µ—Ä–∞—Ç–æ—Ä: –ü–µ—Ç—Ä–æ–≤ –ò.

üü° VM-015-TASH-WEST
‚îú üìç —É–ª. –ê–º–∏—Ä–∞ –¢–µ–º—É—Ä–∞, 15
‚îú ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç —á–∏—Å—Ç–∫–∏
‚îî üë§ –û–ø–µ—Ä–∞—Ç–æ—Ä: –°–∏–¥–æ—Ä–æ–≤ –ê.

[–ü–æ–¥—Ä–æ–±–Ω–µ–µ] [–≠–∫—Å–ø–æ—Ä—Ç PDF]
```

### 7. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

#### 7.1 –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ QR –∫–æ–¥–æ–≤

–ë–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç QR –∫–æ–¥—ã –¥–ª—è:
- –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–æ–≤
- –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –±—É–Ω–∫–µ—Ä–æ–≤
- –ë—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –æ–ø–µ—Ä–∞—Ü–∏—è–º

–§–æ—Ä–º–∞—Ç QR –∫–æ–¥–∞:
```json
{
  "type": "machine|bunker|operation",
  "code": "VM-015-TASH-WEST",
  "action": "service|fill|install"
}
```

#### 7.2 –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è

–ü—Ä–∏ –æ–ø–µ—Ä–∞—Ü–∏—è—Ö —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è:
- GPS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –°–≤–µ—Ä–∫–∞ —Å –ª–æ–∫–∞—Ü–∏–µ–π –∞–≤—Ç–æ–º–∞—Ç–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±–ª–∏–∂–∞–π—à–∏—Ö –∞–≤—Ç–æ–º–∞—Ç–æ–≤

#### 7.3 –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**
- –ù–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
- –ü—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ —Å—Ä–æ–∫–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
- –ò—Å—Ç–µ—á–µ–Ω–∏–µ —Å—Ä–æ–∫–∞ –≥–æ–¥–Ω–æ—Å—Ç–∏
- –ù–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–æ–≤
- –ù–æ–≤—ã–µ –∑–∞–¥–∞—á–∏

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:**
```
‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò –£–í–ï–î–û–ú–õ–ï–ù–ò–ô

üîî –ù–∏–∑–∫–∏–µ –æ—Å—Ç–∞—Ç–∫–∏: –í–ö–õ
‚îú –ü–æ—Ä–æ–≥: < 20%
‚îî –í—Ä–µ–º—è: 08:00

üîî –ì—Ä–∞—Ñ–∏–∫ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è: –í–ö–õ
‚îú –ó–∞: 1 –¥–µ–Ω—å
‚îî –í—Ä–µ–º—è: 09:00

üîî –°—Ä–æ–∫–∏ –≥–æ–¥–Ω–æ—Å—Ç–∏: –í–ö–õ
‚îú –ó–∞: 7 –¥–Ω–µ–π
‚îî –í—Ä–µ–º—è: 10:00
```

#### 7.4 –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –≤–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –£–∫–∞–∑–∞–Ω–∏–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏
- –ü–∞–∫–µ—Ç–Ω—ã–π –≤–≤–æ–¥ –∑–∞ –ø—Ä–æ—à–ª—ã–µ –ø–µ—Ä–∏–æ–¥—ã
- –ò–º–ø–æ—Ä—Ç –∏–∑ Excel/CSV

**–ü—Ä–∏–º–µ—Ä:**
```
–ë–û–¢: üìÖ –ö–æ–≥–¥–∞ –±—ã–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è?
    
    [–°–µ–≥–æ–¥–Ω—è] [–í—á–µ—Ä–∞] [–í—ã–±—Ä–∞—Ç—å –¥–∞—Ç—É]

USER: [–í—ã–±—Ä–∞—Ç—å –¥–∞—Ç—É]

–ë–û–¢: üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É:
    [–ö–∞–ª–µ–Ω–¥–∞—Ä—å inline keyboard]

USER: [15.01.2024]

–ë–û–¢: üïê –í–≤–µ–¥–∏—Ç–µ –≤—Ä–µ–º—è (–ß–ß:–ú–ú):

USER: 14:30

–ë–û–¢: ‚úÖ –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è: 15.01.2024 14:30
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π FSM

```javascript
// states.js
const states = {
  AUTH: {
    PHONE_REQUEST: 'auth.phone_request',
    PHONE_CONFIRM: 'auth.phone_confirm'
  },
  MAIN_MENU: 'main_menu',
  BUNKER: {
    SELECT: 'bunker.select',
    SCAN_QR: 'bunker.scan_qr',
    WEIGH_EMPTY: 'bunker.weigh_empty',
    FILL_INGREDIENT: 'bunker.fill_ingredient',
    WEIGH_FULL: 'bunker.weigh_full',
    PHOTO: 'bunker.photo',
    CONFIRM: 'bunker.confirm'
  },
  // ... –¥—Ä—É–≥–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
};
```

### Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤

```javascript
// middleware/auth.js
const requireRole = (roles) => async (ctx, next) => {
  const user = await getUser(ctx.from.id);
  
  if (!user || !roles.some(role => user.roles.includes(role))) {
    return ctx.reply('‚ùå –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏');
  }
  
  ctx.state.user = user;
  return next();
};
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ–¥–∏–∞ —Ñ–∞–π–ª–æ–≤

```javascript
// handlers/media.js
const handlePhoto = async (ctx, operation) => {
  const photo = ctx.message.photo[ctx.message.photo.length - 1];
  const fileId = photo.file_id;
  
  // –ó–∞–≥—Ä—É–∑–∫–∞ –≤ S3
  const url = await uploadToS3(fileId, operation);
  
  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
  ctx.session.currentOperation.photos.push(url);
  
  return url;
};
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

```javascript
// validators/bunker.js
const validateWeight = (weight) => {
  if (!weight || weight < 0 || weight > 5000) {
    throw new Error('–í–µ—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 0 –¥–æ 5000 –≥—Ä–∞–º–º');
  }
  return true;
};

const validateNetWeight = (empty, full) => {
  if (full <= empty) {
    throw new Error('–í–µ—Å –ø–æ–ª–Ω–æ–≥–æ –±—É–Ω–∫–µ—Ä–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–æ–ª—å—à–µ –ø—É—Å—Ç–æ–≥–æ');
  }
  return true;
};
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å API

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

```javascript
// services/api.js
class VendHubAPI {
  async createBunkerOperation(data) {
    return await fetch('/api/bunkers/operations', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${this.token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(data)
    });
  }
}
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–∞

```javascript
// services/offline.js
class OfflineQueue {
  async add(operation) {
    await redis.lpush('offline_queue', JSON.stringify(operation));
  }
  
  async sync() {
    const operations = await redis.lrange('offline_queue', 0, -1);
    for (const op of operations) {
      try {
        await api.sync(JSON.parse(op));
        await redis.lrem('offline_queue', 1, op);
      } catch (e) {
        console.error('Sync failed:', e);
      }
    }
  }
}
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ú–µ—Ç—Ä–∏–∫–∏

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ —Ç–∏–ø–∞–º
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –±–æ—Ç–∞
- –û—à–∏–±–∫–∏ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```javascript
// utils/logger.js
const logger = winston.createLogger({
  format: winston.format.json(),
  transports: [
    new winston.transports.File({ filename: 'error.log', level: 'error' }),
    new winston.transports.File({ filename: 'combined.log' }),
    new winston.transports.Console({
      format: winston.format.simple()
    })
  ]
});
```

## –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

```dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY . .
CMD ["node", "src/index.js"]
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# Telegram
BOT_TOKEN=your_bot_token
WEBHOOK_URL=https://api.vendhub.uz/telegram/webhook

# Database
DATABASE_URL=postgresql://user:pass@localhost:5432/vendhub

# Redis
REDIS_URL=redis://localhost:6379

# S3
S3_ENDPOINT=https://s3.vendhub.uz
S3_ACCESS_KEY=your_access_key
S3_SECRET_KEY=your_secret_key
S3_BUCKET=vendhub-media

# API
API_BASE_URL=https://api.vendhub.uz
API_KEY=your_api_key
