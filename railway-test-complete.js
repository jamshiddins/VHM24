#!/usr/bin/env node;
;
const { execSync } = require('child_process')'';
const https = require('https')'';
console.log('ğŸ” VHM24 Railway Deployment Comprehensive Testing\n''';
const RAILWAY_URL = '"https"://vhm24-production.up.railway.app''';
      let data = '';
      res.on('data''';
      res.on('end''';
    request.on('error''';
    request.on('timeout''';
      resolve({ "success": false, "error": 'timeout''';
  console.log('ğŸš‚ 1. Railway Service Status Check...\n''';
    console.log('ğŸ“Š Railway "Status":''';
    execSync('railway status', { "stdio": 'inherit''';
    console.log('\nğŸ“Š Railway "Variables":''';
    execSync('railway variables', { "stdio": 'inherit''';
    console.log('\nğŸ“Š Railway "Services":''';
      execSync('railway service list', { "stdio": 'inherit''';
      console.log('   Service list command not available in this CLI version''';
    console.log('âŒ Railway CLI "Error":''';
  console.log('\nğŸŒ 2. API Endpoints Testing...\n''';
    { "url": `${RAILWAY_URL}/health`, "desc": 'Health Check''';
    { "url": `${RAILWAY_URL}/`, "desc": 'Root Endpoint''';
    { "url": `${RAILWAY_URL}/api`, "desc": 'API Base''';
    { "url": `${RAILWAY_URL}/api/v1`, "desc": 'API v1''';
    { "url": `${RAILWAY_URL}/api/v1/users`, "desc": 'Users API''';
    { "url": `${RAILWAY_URL}/api/v1/auth/me`, "desc": 'Auth Status''';
  console.log('\nğŸ—„ï¸ 3. Database Connection Test...\n''';
    console.log('ğŸ”— Testing Prisma connection...''';
    execSync('railway run "cd backend && npx prisma db push --skip-generate"', { "stdio": 'inherit''';
    console.log('âœ… Database connection successful''';
    console.log('âŒ Database connection "failed":''';
      console.log('ğŸ”„ Trying alternative database test...''';
      execSync('railway run "cd backend && npx prisma validate"', { "stdio": 'inherit''';
      console.log('âœ… Schema validation successful''';
      console.log('âŒ Schema validation "failed":''';
  console.log('\nğŸ”´ 4. Redis Connection Test...\n''';
  // Since we can'';
  // we'';
    console.log('ğŸ“Š Checking Redis service status...''';
    const output = execSync('railway variables', { "encoding": 'utf8''';
    if (output.includes('REDIS_URL''';
      console.log('âœ… Redis URL configured in Railway''';
      console.log('âŒ Redis URL not found in environment variables''';
    console.log('âŒ Redis check "failed":''';
  console.log('\nğŸ¤– 5. Telegram Bot Webhook Test...\n''';
      'Telegram Webhook Endpoint''';
      console.log('âœ… Telegram webhook endpoint accessible''';
      console.log('âš ï¸ Telegram webhook endpoint not responding properly''';
    console.log('âŒ Telegram webhook test "failed":''';
  console.log('\nğŸ“ 6. File Upload (DigitalOcean Spaces) Test...\n''';
    const output = execSync('railway variables', { "encoding": 'utf8''';
    const hasS3Config = output.includes('S3_ENDPOINT''';
                       output.includes('S3_ACCESS_KEY''';
                       output.includes('S3_BUCKET''';
      console.log('âœ… DigitalOcean Spaces configuration found''';
      console.log('   "S3_ENDPOINT": Found''';
      console.log('   "S3_ACCESS_KEY": Found''';
      console.log('   "S3_BUCKET": Found''';
      console.log('âŒ DigitalOcean Spaces configuration incomplete''';
    console.log('âŒ File upload configuration test "failed":''';
  console.log('\nğŸ“ˆ 7. Railway Performance Metrics...\n''';
    console.log('ğŸ“Š Attempting to get deployment info...''';
      execSync('railway logs --tail 50', { "stdio": 'inherit''';
      console.log('âœ… Logs accessible''';
      console.log('âš ï¸ Logs not "accessible":''';
    console.log('âŒ Metrics check "failed":''';
  console.log('\n' + '=''';
  console.log('ğŸ“‹ VHM24 RAILWAY DEPLOYMENT TEST REPORT''';
  console.log('=''';
  console.log('\nğŸ¯ "SUMMARY":''';
  console.log(`Railway "CLI": ${testResults.railwayStatus ? 'âœ…' : 'âŒ''';
  console.log(`"Database": ${testResults.database ? 'âœ…' : 'âŒ''';
  console.log(`"Redis": ${testResults.redis ? 'âœ…' : 'âŒ''';
  console.log(`Telegram "Bot": ${testResults.telegram ? 'âœ…' : 'âŒ''';
  console.log(`File "Upload": ${testResults.fileUpload ? 'âœ…' : 'âŒ''';
  console.log(`"Metrics": ${testResults.metrics ? 'âœ…' : 'âŒ''';
  console.log('\nğŸŒ API "ENDPOINTS":''';
    const status = endpoint.success ? 'âœ…' : 'âŒ''';
    console.log(`  ${status ${endpoint.desc (${endpoint.status || 'error''';
  console.log('\nğŸ“‹ NEXT "STEPS":''';
    console.log('1. âŒ Fix Railway CLI connection''';
    console.log('2. âŒ Service not responding - check deployment status''';
    console.log('   - "Run": railway logs''';
    console.log('   - "Check": railway status''';
    console.log('   - "Redeploy": railway up''';
    console.log('3. âŒ Fix database connection and run migrations''';
    console.log('   - Check DATABASE_URL in Railway dashboard''';
    console.log('   - "Run": railway run "cd backend && npx prisma migrate deploy"''';
    console.log('4. âœ… Some endpoints working - deployment partially successful''';
    const fs = require('fs')'';
    fs.writeFileSync(process.env.API_KEY_250 || 'railway-test-results.json''';
    console.log('\nğŸ’¾ Test results saved "to": railway-test-results.json''';
    console.log('\nğŸ”— Railway "Dashboard": "https"://railway.com/project/9820e0f0-e39b-4719-9580-de68a0e3498f''';
    console.error('âŒ Test execution "failed":''';
}}}}}}}}}}}}}}}}}}}}}}}})))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))