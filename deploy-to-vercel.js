#!/usr/bin/env node

/**
 * –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π VHM24 –Ω–∞ Vercel
 */

const { execSync } = require('child_process');
const fs = require('fs');

console.log('üöÄ –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π VHM24 –Ω–∞ Vercel...\n');

try {
  // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ Vercel CLI
  console.log('üîç 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ Vercel CLI...');
  try {
    execSync('vercel --version', { stdio: 'pipe' });
    console.log('‚úÖ Vercel CLI —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
  } catch (error) {
    console.log('‚ùå Vercel CLI –Ω–µ –Ω–∞–π–¥–µ–Ω');
    console.log('üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Vercel CLI...');
    execSync('npm install -g vercel', { stdio: 'inherit' });
    console.log('‚úÖ Vercel CLI —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
  }

  // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
  console.log('\nüîß 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...');
  if (fs.existsSync('vercel.json')) {
    console.log('‚úÖ vercel.json –Ω–∞–π–¥–µ–Ω');
  } else {
    console.log('‚ùå vercel.json –Ω–µ –Ω–∞–π–¥–µ–Ω');
    process.exit(1);
  }

  // 3. Git –∫–æ–º–º–∏—Ç —Å Vercel —Ñ–∞–π–ª–∞–º–∏
  console.log('\nüì¶ 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Git...');
  execSync('git add vercel.json VERCEL_DEPLOYMENT_GUIDE.md deploy-to-vercel.js', { stdio: 'inherit' });
  execSync('git commit -m "feat: add Vercel deployment configuration\n\n- Add vercel.json for serverless deployment\n- Add comprehensive Vercel deployment guide\n- Add quick deploy script\n- Ready for Vercel production deployment"', { stdio: 'inherit' });
  console.log('‚úÖ Git –æ–±–Ω–æ–≤–ª–µ–Ω');

  // 4. Push –∫ remote
  console.log('\nüì§ 4. Push to remote...');
  try {
    execSync('git push origin main', { stdio: 'inherit' });
    console.log('‚úÖ Changes pushed to GitHub');
  } catch (error) {
    console.log('‚ö†Ô∏è Push to remote failed, –Ω–æ –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
  }

  // 5. Vercel –¥–µ–ø–ª–æ–π
  console.log('\nüöÄ 5. –ó–∞–ø—É—Å–∫ Vercel –¥–µ–ø–ª–æ—è...');
  console.log('üìã –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º Vercel CLI:');
  console.log('   - Project name: vhm24-backend');
  console.log('   - Directory: ./');
  console.log('   - Build command: (default)');
  console.log('   - Output directory: (default)\n');

  // –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –¥–µ–ø–ª–æ–π
  execSync('vercel', { stdio: 'inherit' });

  console.log('\nüéâ –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω!');
  console.log('üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:');
  console.log('1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å environment variables –≤ Vercel Dashboard');
  console.log('2. –ó–∞–ø—É—Å—Ç–∏—Ç—å production –¥–µ–ø–ª–æ–π: vercel --prod');
  console.log('3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å health check –Ω–∞ –≤–∞—à–µ–º Vercel URL');
  console.log('4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å database (Supabase/PlanetScale)');

} catch (error) {
  console.error('‚ùå –û—à–∏–±–∫–∞ –¥–µ–ø–ª–æ—è:', error.message);
  console.log('\nüìã –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π:');
  console.log('1. npm install -g vercel');
  console.log('2. vercel login');
  console.log('3. vercel');
  console.log('4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å environment variables');
  console.log('5. vercel --prod');
}
